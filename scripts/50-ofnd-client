#!/bin/sh
# dhclient exit hook to capture custom friendly network detection option
# This file is dropped into /etc/dhcp/dhclient-exit-hooks.d/ by the package.
# Variables provided by dhclient: new_<option-name-with-dashes-replaced-by-underscores>
# We declared the option name as fnd-server-ip -> new_fnd_server_ip

FND_RUN_DIR=/run/fnd
FND_DHCP_IP_FILE="$FND_RUN_DIR/dhcp_server_ip"

mkdir -p "$FND_RUN_DIR"

if [ -n "$new_fnd_server_ip" ]; then
  echo "$new_fnd_server_ip" > "$FND_DHCP_IP_FILE".new
  mv "$FND_DHCP_IP_FILE".new "$FND_DHCP_IP_FILE"
  systemctl kill -s SIGUSR1 open-friendly-net-detection-client.service 2>/dev/null || true
fi

exit 0
